<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>이력서 RAG 챗봇</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 600px; margin: 20px auto; padding: 15px; background-color: #f9f9f9; }
        h2 { text-align: center; }
        #chat-log { border: 1px solid #ddd; border-radius: 8px; height: 400px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; background-color: #fff; }
        #chat-log div { margin-bottom: 10px; line-height: 1.4; }
        #chat-log b { color: #007bff; }
        #chat-form { display: flex; }
        #query-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-size: 16px; }
        #send-button { border: none; background-color: #007bff; color: white; padding: 10px 15px; margin-left: 10px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        #send-button:hover { background-color: #0056b3; }
        #send-button:disabled { background-color: #ccc; }
    </style>
</head>
<body>
    <h2>이력서 RAG 챗봇 </h2>
    <div id="chat-log">
        <div><b>AI:</b> 안녕하세요! 이력서에 대해 무엇이든 물어보세요.</div>
    </div>
    <form id="chat-form">
        <input type="text" id="query-input" placeholder="여기에 질문 입력..." autocomplete="off">
        <button type="submit" id="send-button">전송</button>
    </form>

    <script>
        const chatForm = document.getElementById('chat-form');
        const sendButton = document.getElementById('send-button');
        const queryInput = document.getElementById('query-input');
        const chatLog = document.getElementById('chat-log');

        // 폼 제출(전송 버튼 클릭 또는 엔터) 이벤트 처리
        chatForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // 페이지가 새로고침되는 것을 막음
            sendMessage();
        });

        async function sendMessage() {
            const query = queryInput.value.trim();
            if (query === "") return;

            // 1. 사용자 질문을 로그에 표시
            addMessage("User", query);
            queryInput.value = "";
            sendButton.disabled = true; // 전송 버튼 비활성화

            // 2. Spring Boot 백엔드 API 호출
            try {
                // HTML이 localhost:8080에서 서빙되므로, API 주소도 상대경로인 /chat으로 가능
                const response = await fetch('/chat', { // Postman의 http://localhost:8080/chat 와 동일
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query }) // Postman의 JSON Body
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const answer = await response.text();

                // 3. AI 답변을 로그에 표시
                addMessage("AI", answer);
            } catch (error) {
                addMessage("Error", "API 호출에 실패했습니다: " + error);
            } finally {
                sendButton.disabled = false; // 전송 버튼 다시 활성화
                queryInput.focus(); // 입력창에 다시 포커스
            }
        }

        // 채팅 로그에 메시지 추가
        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<b>${sender}:</b> ${message.replace(/\n/g, '<br>')}`; // \n을 <br>로 바꿔 줄바꿈
            chatLog.appendChild(messageElement);
            chatLog.scrollTop = chatLog.scrollHeight; // 스크롤을 항상 맨 아래로
        }
    </script>
</body>
</html>